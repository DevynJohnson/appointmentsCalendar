# Render.yaml Setup Guide for Zone Meet

## ğŸ¯ What is render.yaml?

`render.yaml` is an **Infrastructure as Code (IaC)** file that defines your entire Render deployment configuration. Instead of manually configuring everything in the Render dashboard, you define it in code and commit it to your repository.

## ğŸ“ File Location

Your `render.yaml` file should be in the **root** of your repository:
```
appointmentsCalendar/
â”œâ”€â”€ render.yaml                    â† Here (root level)
â”œâ”€â”€ appointments_calendar/         â† Your Next.js app
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ ...
â””â”€â”€ README.md
```

## ğŸš€ How to Deploy with render.yaml

### Method 1: New Service Creation (Recommended)

1. **Go to Render Dashboard**
   - Visit [render.com](https://render.com) and log in
   - Click **"New +"** â†’ **"Blueprint"**

2. **Connect Repository**
   - Connect your GitHub repository (`DevynJohnson/appointmentsCalendar`)
   - Render will automatically detect your `render.yaml` file

3. **Review Configuration**
   - Render will show you what will be created:
     - Web service (`zone-meet`)
     - PostgreSQL database (`zone-meet-db`)
     - Environment variables
     - Security headers

4. **Deploy**
   - Click **"Apply"** to create all services
   - Render will build and deploy automatically

### Method 2: Existing Service Migration

If you already have a Render service:

1. **Add render.yaml to repository**
2. **Go to existing service settings**
3. **Enable "Auto-Deploy from Blueprint"**
4. **Next deployment will use render.yaml configuration**

## ğŸ”§ Configuration Breakdown

### Web Service Configuration
```yaml
services:
  - type: web
    name: zone-meet              # Service name in Render
    runtime: node               # Node.js runtime
    plan: starter               # Pricing plan (starter = free)
    buildCommand: npm ci && npm run build  # Build steps
    startCommand: npm start     # Start command
    healthCheckPath: /api/health # Health check endpoint
```

### Environment Variables
```yaml
envVars:
  - key: NODE_ENV
    value: production          # Always production for deployed apps
  - key: WAF_ENABLED
    value: true               # Enable WAF protection
  - key: WAF_RATE_LIMIT_MAX_REQUESTS
    value: 100               # Allow 100 requests per minute
```

### Security Headers
```yaml
headers:
  - name: "X-Frame-Options"
    value: "DENY"            # Prevent clickjacking
  - name: "X-Content-Type-Options"
    value: "nosniff"         # Prevent MIME sniffing
```

### Database Service
```yaml
  - type: pserv              # PostgreSQL service
    name: zone-meet-db       # Database name
    plan: starter            # Free tier
    databaseName: zonemeet   # Database name
```

## ğŸ” Sensitive Environment Variables

**Important:** Don't put sensitive values directly in `render.yaml`! Add them through the dashboard:

### Set via Render Dashboard:
```bash
# These should NOT be in render.yaml
DATABASE_URL=postgresql://...     # Auto-generated by database service
JWT_SECRET=your-secret-key        # Add manually in dashboard
MAILEROO_API_KEY=your-api-key    # Add manually in dashboard
SENTRY_DSN=https://...           # Add manually in dashboard
```

### Set via render.yaml:
```bash
# These are safe to include
NODE_ENV=production
WAF_ENABLED=true
WAF_RATE_LIMIT_MAX_REQUESTS=100
```

## ğŸ“Š Health Check Endpoint

Your `render.yaml` references `/api/health`. I've created this endpoint at:
```
src/app/api/health/route.ts
```

This endpoint checks:
- **Service status** (healthy/unhealthy)
- **Database connectivity**
- **WAF configuration**
- **Security headers status**
- **System metrics** (memory, uptime)

### Test Health Check Locally:
```bash
# Start your development server
npm run dev

# Test health endpoint
curl http://localhost:3000/api/health
```

## ğŸŒ Custom Domains

After initial deployment, add custom domains:

1. **Update render.yaml:**
```yaml
domains:
  - www.zone-meet.com
  - zone-meet.com
```

2. **Configure DNS:**
```
# Add these CNAME records in your domain provider
www.zone-meet.com â†’ your-app-name.onrender.com
zone-meet.com â†’ your-app-name.onrender.com (or A record to IP)
```

## ğŸ“ˆ Scaling Configuration

### Basic Scaling (render.yaml):
```yaml
numInstances: 1        # Number of instances
plan: starter          # starter/standard/pro
```

### Production Scaling:
```yaml
numInstances: 2        # High availability
plan: standard         # Better performance
region: oregon         # Choose closest region
```

## ğŸ”„ Deployment Process

### Automatic Deployments
When you push to `main` branch:
1. **Render detects changes** to your repository
2. **Reads render.yaml** for configuration
3. **Builds application** using `buildCommand`
4. **Deploys** using `startCommand`
5. **Health check** verifies deployment
6. **Goes live** when health check passes

### Manual Deployments
You can also trigger manual deployments:
1. **Go to service in Render dashboard**
2. **Click "Manual Deploy"**
3. **Choose branch/commit**

## ğŸš¨ Troubleshooting

### Common Issues:

#### 1. Build Failures
```bash
# Check your package.json scripts
"scripts": {
  "build": "next build",    # Must exist
  "start": "next start"     # Must exist
}
```

#### 2. Health Check Failures
- Ensure `/api/health` endpoint exists
- Check that it returns 200 status
- Verify no blocking errors in logs

#### 3. Environment Variable Issues
- Sensitive vars: Add via dashboard
- Public vars: Can be in render.yaml
- Check spelling and formatting

#### 4. Database Connection
- Database URL auto-generated by Render
- Check service is in same region
- Verify database service is running

## ğŸ“‹ Next Steps After Deployment

1. **Verify Health Check**
   ```bash
   curl https://your-app.onrender.com/api/health
   ```

2. **Add Sensitive Environment Variables**
   - Go to service settings in Render dashboard
   - Add: `JWT_SECRET`, `MAILEROO_API_KEY`, `SENTRY_DSN`, etc.

3. **Test WAF Protection**
   ```bash
   # Should be blocked
   curl "https://your-app.onrender.com/api/test?id=1' OR '1'='1"
   ```

4. **Configure Custom Domain** (optional)
   - Add domain records in render.yaml
   - Update DNS settings
   - Wait for SSL certificate provisioning

5. **Monitor Deployment**
   - Check logs in Render dashboard
   - Verify security headers: https://securityheaders.com
   - Test application functionality

## ğŸ‰ Benefits of render.yaml

- **Version Control:** Infrastructure changes tracked in Git
- **Reproducible:** Same configuration across environments
- **Automated:** No manual dashboard configuration
- **Team Friendly:** Everyone can see infrastructure setup
- **Backup:** Configuration preserved in code

---

**Your Zone Meet application is now ready for professional deployment with render.yaml! ğŸš€**